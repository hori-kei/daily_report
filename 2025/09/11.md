# 取り組んだ課題一覧

- 現場で使えるDjangoの教科書(第6章 モデルマネージャとクエリセット~)

# わかったこと

- モデルマネージャとはモデルクラスにくっついたDB操作のためのインターフェース
- Djangoでのモデルマネージャはobjects（例) Book.objects.get(pk=1))
- クエリセットとはモデルマネージャから返ってくる検索結果の入れ物
- クエリセットの実態はモデルインスタンスの集まり
- Pythonのリストに似ているが、遅延評価という特徴を持つ
    - 遅延評価とはコード上でfor, インデックスやスライス、list(),len(),bool(),print()を実行した際、DBのデータが必要になったタイミングで実行されること
- 一度取得したら再利用できる
- get()は検索結果に一致するモデルオブジェクトを１件だけ取得する。
    - 条件に必ず１件だけ該当することがわかっている場合に使用
    - 不確定ならfilter()を使うほうが安全
    
    ```python
    book = Book.objects.get(title="Djangoの本")
    book = Book.objects.get(pk=1)
    print(book.title, book.price)
    ```
    
- all()はテーブル内の全レコードを取得し、戻り値はQuerySet
    - 検索結果が0件でも例外は出ず、殻のQuerySetが返る
    
    ```python
    book = Book.objects.all()
    
    for book in books:
    	print(book.title, book.price)
    ```
    
- filter()は条件に合うレコードだけ取得
    - 複数件取得する可能性があるので返り値はQuerySet
    
    ```python
    book = Book.objects.filter(price=1500)
    
    for book in books:
    	print(book.title)
    ```
    
    - filterのそれぞれの書き方
        - 完全一致：filter(title=”Djangoの本”)
        - 複数条件(AND)：filter(title=”Djangoの本”, price=1500)
        - 複数条件(OR)：filter(Q(title=”Djangoの本”) | Q(price=1500))
        - 比較演算子：__(アンダーバー2つ) + キーワードで表す
            - キーワードはgt(greater than), lt(less than), gte(greater than or equal),lge(less than or equal)
        - IN句：books = Book.objects.filter(price__in=[1000, 1500])
        - Like検索
            - icontaains(大文字・小文字区別なし)： books = Book.objects.filter(title__icontains=”Djano”)
        - リレーション先のフィールドで検索：books = Book.objects.filter(publisher__name=”Django”)
        - exist()存在確認：条件にあうレコードが存在するかをTrue/Falseで返す
        - count():条件に合うレコード数を返す
        - order_by()：指定したフィールドで並び替え。デフォは昇順
        - aggregate():Sum,Avg,Max,Minを計算できる。結果はdictで返る
        - annotate() 各レコードごとの集計値を追加できる
- QuerySetが遅延評価する理由
    - 無駄なDBアクセスを減らしてパフォーマンスを良くするため
    - 複数のフィルタをつなげても、最後にまとめてSQLを発行できるため

# 次やること

- 現場で使えるDjangoの教科書(第6章 モデルオブジェクトを保存・更新・削除する~)

# 感じたこと

- 今週全然勉強できなかったわ。。。

# 学習時間

-  1.0時間